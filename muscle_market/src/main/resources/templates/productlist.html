<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>상품 목록</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f7f8fa;
            margin: 0;
            padding: 0;
        }

        .page-content {
            padding: 90px 140px 50px 140px;
        }

        h1 {
            font-size: 2em;
            margin-bottom: 5px;
            color: #333;
        }

        h2 {
            font-size: 1.1em;
            margin-bottom: 30px;
            color: #666;
        }

        /*가로 4칸 세로 5칸*/
        .product-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-auto-rows: 1fr; /* 각 행의 높이를 자동으로 맞춤 */
            gap: 20px;
        }

        /* 상품 카드 */
        .product-item {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .product-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .product-item img {
            width: 100%;
            aspect-ratio: 1/1; /* 이미지 비율 1:1 유지 */
            object-fit: cover;
        }

        .product-details {
            padding: 12px 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .product-title {
            font-size: 1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .product-price {
            color: #ff4757;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 6px;
        }

        .product-info {
            font-size: 0.85em;
            color: #777;
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .product-stats {
            font-size: 0.8em;
            color: #999;
            display: flex;
            justify-content: space-between;
        }

        .product-date {
            font-size: 0.75em;
            color: #aaa;
            margin-top: 6px;
        }

        /* --- 페이지네이션 스타일 (변경 없음) --- */
        .pagination {
            margin-top: 40px;
            text-align: center;
        }

        .pagination a {
            padding: 8px 14px;
            margin: 0 4px;
            border: 1px solid #ddd;
            text-decoration: none;
            color: #333;
            border-radius: 6px;
            transition: background-color 0.2s, color 0.2s;
        }

        .pagination a.active {
            background-color: #333;
            color: #fff;
            border-color: #333;
        }

        .pagination a:hover {
            background-color: #555;
            color: #fff;
            border-color: #555;
        }

        /* 미디엄 화면 (태블릿 가로, 랩탑)에서는 3열로 변경 */
        @media (max-width: 1200px) {
            .product-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* 스몰 화면 (태블릿 세로, 큰 모바일)에서는 2열로 변경 */
        @media (max-width: 768px) {
            .product-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .page-content {
                padding: 90px 20px 20px 20px; /* 패딩도 줄여줌 */
            }
        }

        /* 플로팅 버튼 컨테이너 */
        .floating-buttons {
            position: fixed;
            right: 30px; /* 오른쪽에서 30px */
            bottom: 30px; /* 아래쪽에서 30px */
            display: flex;
            flex-direction: column;
            gap: 15px; /* 버튼 간 간격 */
            z-index: 100; /* 다른 요소 위에 표시 */
        }

        /* 개별 플로팅 버튼 스타일 */
        .floating-btn {
            width: 60px; /* 버튼 크기 고정 */
            height: 60px;
            border-radius: 50%; /* 원형 */
            border: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .floating-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        /* 게시물 등록 버튼 색상 */
        .btn-new-post {
            background-color: #F5C542;;
            line-height: 1; /* 텍스트 정렬 */
        }

        .btn-kakao {
            line-height: 1;
        }

        /* AI 버튼 색상 및 스타일 */
        .btn-ai-assist {
            background-color: #007bff; /* 파란색 계열로 구분 */
            font-size: 1.1em;
            line-height: 1;
        }

        /* --- 카테고리 드롭다운 스타일 --- */
        .category-filter-bar {
            position: absolute;
            top: 100px; /* h1과 겹치지 않게 아래로 */
            right: 140px;
            z-index: 100;
        }

        .category-wrapper {
            position: relative;
            display: inline-block;
        }

        /* 버튼 기본 스타일 */
        .category-button {
            background-color: #fff;
            color: #333;
            border: 1px solid #ccc;
            padding: 10px 18px;
            /*버튼 너비 나중에 긴 이름의 종목이 나올 수 있어서 길게 잡읍*/
            width: 200px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            text-align: left;
        }

        .category-button:hover {
            background-color: #f5f5f5;
        }

        /* 메뉴 박스 */
        .category-menu {
            list-style: none;
            margin: 0;
            padding: 8px 0;
            position: absolute;
            top: 0;
            width: 200px;
            /*left: 100%;*/ /*나오게 되는 위치*/
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: none; /* 기본 숨김 */
        }

        /* hover 시 표시 */
        .category-wrapper:hover .category-menu {
            display: block;
        }

        /* 메뉴 아이템 스타일 */
        .category-menu li {
            padding: 10px 15px;
            color: #333;
            font-size: 0.95rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .category-menu li:hover {
            background-color: #f0f0f0;
        }
    </style>
    <link th:href="@{/css/header.css}" rel="stylesheet"/>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<div class="category-filter-bar">
    <div class="category-wrapper">
        <button id="categoryButton" class="category-button">
            <span id="selectedCategory"
                  th:text="${selectedSportName != null ? selectedSportName : '전체 종목'}">
            전체 종목
        </span>
        </button>
        <ul class="category-menu" id="categoryMenu">
            <li data-sport-id="null">전체 종목</li>
            <li th:each="sport : ${sports}"
                th:data-sport-id="${sport.id}"
                th:text="${sport.name}">
                축구
            </li>
        </ul>
    </div>
</div>

<main class="page-content">
    <h1>경제적인 장비 업그레이드</h1>
    <h2>나를 죽이지 못한 고통은 나를 더 강하게 만든다</h2>

    <ul class="product-grid">
        <li th:each="product : ${productPage.content}" class="product-item">
            <a th:href="@{'/products/' + ${product.id}}">
                <img th:src="${product.thumbnailUrl} ?: '/images/no_image.png'" alt="상품 이미지">
            </a>
            <div class="product-details">
                <div>
                    <div class="product-title" th:text="${product.title}">덤벨 세트 20kg</div>
                    <div class="product-price"
                         th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + '원'">50,000원
                    </div>
                    <div class="product-info">
                        <!--                        <span th:text="${product.location}">서울 강남구</span>-->
                        <span th:text="${product.sportName}">헬스</span>
                    </div>
                    <div class="product-date" th:text="${#dates.format(product.createdAt, 'yyyy-MM-dd')}">2025-11-11
                    </div>
                </div>
                <div class="product-stats">
                    <span>조회수 <span th:text="${product.views}">120</span></span>
                    <span>찜 <span th:text="${product.likeCount}">2</span></span>
                </div>
            </div>
        </li>
    </ul>

    <div class="pagination" th:if="${productPage.totalPages > 0}">
        <span th:each="pageNum : ${#numbers.sequence(0, productPage.totalPages - 1)}">
            <a th:href="@{/products(page=${pageNum}, sportId=${currentSportId})}"
               th:class="${pageNum == currentPage ? 'active' : ''}"
               th:text="${pageNum + 1}">1
            </a>
        </span>
    </div>
</main>

<div class="floating-buttons">
    <!--    새 게시물, 카카오 맵, -->
    <button class="floating-btn btn-new-post" onclick="location.href='/products/new'">
        +
    </button>

    <!--    이동 주소 수정-->
    <button class="floating-btn btn-kakao" onclick="location.href='/products/map'">
        MAP
    </button>

    <button class="floating-btn btn-ai-assist" onclick="alert('AI 기능 구현 예정')">
        AI
    </button>
</div>
<script th:src="@{/js/header.js}" defer></script>
<script th:inline="javascript">
    // url에서 sportId 가져옴
    // function getQueryParam(param) {
    //     const urlParams = new URLSearchParams(window.location.search);
    //     return urlParams.get(param);
    // }
    //
    // const currentSportId = [[${currentSportId}]] || null;
    // const currentSportName = [[${selectedSportName}]] || '전체 종목';

    document.addEventListener("DOMContentLoaded", function () {
        const menu = document.getElementById("categoryMenu");
        const selectedText = document.getElementById("selectedCategory");

        // 각 항목 클릭 시 페이지 이동 및 이름 변경
        menu.addEventListener("click", function (e) {
            const item = e.target.closest("li");
            if (!item) return;

            const sportId = item.dataset.sportId;
            const sportName = item.textContent.trim();
            selectedText.textContent = sportName; // 버튼 텍스트 변경

            // URL 이동
            let targetUrl = '/products';
            if (sportId && sportId !== 'null') {
                targetUrl += `?sportId=${sportId}`;
            }
            window.location.href = targetUrl;
        });
        console.log("선택된 종목 ID:", selectedId);
        console.log("선택된 종목명:", selectedName);
    });

</script>
</body>
</html>
