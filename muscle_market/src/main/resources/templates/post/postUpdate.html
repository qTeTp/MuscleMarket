<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>게시글 작성</title>
    <!-- Tailwind CSS 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Inter 폰트 사용 (Figma와 유사한 깔끔한 폰트) */
        body {
            font-family: 'Montserrat', 'Pretendard', sans-serif;
            background-color: #f8f9fa; /* 피그마 배경과 유사한 색상 */
        }
        /* 피그마의 회색 버튼 스타일 */
        .btn-secondary {
            background-color: #f1f3f5;
            border: 1px solid #dee2e6;
            color: #495057;
        }
        .btn-secondary:hover {
            background-color: #e9ecef;
        }
        /* 피그마의 흰색 버튼 스타일 */
        .btn-outline {
            background-color: #ffffff;
            border: 1px solid #ced4da;
            color: #495057;
        }
        .btn-outline:hover {
            background-color: #f8f9fa;
        }
        /* 피그마의 기본 파란색 버튼 (예시) */
        .btn-primary {
            background-color: #3b82f6; /* 예시 파란색 */
            color: white;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
    </style>
    <!-- Inter 폰트 로드 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-white">
    <main id="board-new-post" class="w-full max-w-4xl mx-auto px-4 py-10">
        <h1 class="text-3xl font-bold mb-8">게시글 작성</h1>

        <div class="space-y-6">
            <!-- 제목 -->
            <div class="flex items-center">
                <input type="text" placeholder="제목을 작성해주세요" class="flex-grow border border-gray-300 rounded-md p-3 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <select class="border border-gray-300 rounded-md p-3 text-sm ml-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">-- 운동 선택 --</option>
                    <option value="soccer">축구</option>
                    <option value="basketball">농구</option>
                </select>
            </div>
            
            <!-- 본문 -->
            <div>
                <textarea class="w-full border border-gray-300 rounded-md p-3 h-96 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="본문을 작성해주세요"></textarea>
            </div>

            <!-- 버튼 영역 -->
            <div class="flex justify-between items-center pt-4">
                <button class="btn-outline px-4 py-2 rounded-md font-medium text-sm">
                    이미지 업로드
                </button>
                <div class="flex gap-2">
                    <button class="btn-secondary px-6 py-3 rounded-md font-medium">취소</button>
                    <button class="btn-primary px-6 py-3 rounded-md font-medium">작성</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // 현재 로그인한 유저
        let currentUser = null;
        
        // CSRF Token
        const csrfToken = document.querySelector("meta[name='_csrf']").getAttribute('content');
        const csrfHeader = document.querySelector("meta[name='_csrf_header']").getAttribute('content');


        // 현재 로그인한 유저 정보 가져오기
        async function fetchCurrentUserAndInit() {
            try {
                const res = await fetch('/api/users/me', {
                    method: 'GET',
                    headers: {
                        [csrfHeader]: csrfToken
                    }
                });

                if (!res.ok) {
                    throw new Error('인증 실패. 로그인이 필요합니다.');
                }

                currentUser = await res.json();
                initializeApp();
            } catch (error) {
                console.error(error.message);
                // 로그인 페이지로 강제 이동
                window.location.href = "/login";
            }
        } 

        // 페이지 로드 될 때 실행되는 함수
        function initializeApp() {

        }


        // XSS 공격 방지
        function escapeHtml(text) {
            if (!text) return '';
            return text
                .replace(/&/g, "&amp")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        document.addEventListener('DOMContentLoaded', () => {
            // 1. 로그인 유저 정보 가져오고 다른 데이터 fetch
            fetchCurrentUserAndInit();
        });
    </script>
</body>
</html>